# 專案背景 (Project Context)
本專案為「在森林那邊 - 輕量級電商庫存管理系統 (ERP V2.3)」，基於 Google Sheets 與 Google Apps Script (GAS) 開發，整合行動端 Web App 進行現場作業。

## 1. 核心技術堆疊
- **資料庫:** Google Sheets (作為關聯式資料庫)。
- **後端:** Google Apps Script (.gs) 搭配 LockService 進行並發控制。
- **前端:** GAS HTML Service (SPA 單頁應用)，採用 Bootstrap 5 與 SweetAlert2 (Toast Notification)。
- **架構:** Vibe Coding (AI 驅動開發)。

## 2. 系統模組架構
### A. Web App (前端介面)
- **Header:** 具備「使用者切換 (User Selector)」功能，支援多員工操作紀錄。
- **Tab 1 撿貨 (Picking):** - 顯示當日撿貨單，支援一鍵複製。
  - 「出貨完成」按鈕觸發清空暫存區。
- **Tab 2 庫存 (Inventory):** - **分組顯示:** 依據 [商品/原料/包材] 分類，自動過濾掉 [組合] 與 [Soft_Delete]。
  - **Smart Adjustment:** 點擊數字可直接輸入盤點值，後端寫入紀錄 (含操作者姓名)。
- **Tab 3 入庫 (Inbound):** - 下拉選單支援 `optgroup` 分組。
  - 僅顯示實體單品，自動隱藏虛擬組合商品。

### B. Google Apps Script (後端邏輯)
- **`Code.gs`:** API 入口。全寫入操作皆實作 `LockService` 防止多人衝突。
- **`InventoryManager.gs`:** 運算核心。`refreshDashboard()` 負責重算庫存。
- **`Archiver.gs`:** **[V2.3 新增]** 自動化維護機器人。每月自動檢查 `[03_銷售數據池]`，將超過 2000 筆的舊資料搬移至 `[Backup_Sales]`。
- **`main.gs`:** 批次處理核心。負責訂單解析與匯入。

## 3. 資料結構 (Schema)
| 工作表 | 用途 | 關鍵欄位/結構 |
| :--- | :--- | :--- |
| **[00_儀表板]** | (唯讀) 庫存總表 | 程式自動計算。C欄:當前庫存, E欄:狀態燈號。 |
| **[00_數據暫存區]** | (輸入) 訂單匯入 | A欄: 蝦皮文字 (支援多行聚合), C欄: 官網表格。 |
| **[02_生產紀錄]** | (流水帳) 操作紀錄 | `[日期, SKU, 數量, 備註(含操作者)]`。 |
| **[03_銷售數據池]** | (流水帳) 銷貨紀錄 | `[日期, 平台, 訂單號, SKU, 數量...]`。由 Archiver 自動維護。 |
| **[Backup_Sales]** | (封存) 歷史資料 | 存放從 [03] 移出的舊資料。 |
| **[04_SKU對照表]** | (設定) 系統大腦 | **A-H 8欄結構**: F:狀態, **G:分類**, **H:安全庫存**。 |

## 4. 關鍵業務規則
- **管單品，不管組合:** 入庫與庫存顯示皆排除「組合」分類。
- **多人協作安全:** 所有寫入動作 (入庫/盤點) 強制排隊 (Lock)，並記錄操作者身分。
- **歷史封存:** 系統自動保留 `[03_銷售數據池]` 最新 2000 筆資料，確保運算效能。