# 專案背景 (Project Context)
本專案為「在森林那邊 - 輕量級電商庫存管理系統 (ERP V3.1 Clean)」，基於 Google Sheets 與 Google Apps Script (GAS) 開發。

## 1. 目前版本狀態：V3.1 (Clean Version)
本版本移除複雜的 Webhook 即時串接，回歸 **「批次處理」** 與 **「排程報告」** 核心，追求系統的最大穩定性與低維護成本。

### ✅ 核心功能
- **雙平台解析 (Batch Parsing)**: 
  - 支援手動貼上 **蝦皮 (Shopee)** 與 **官網 (WooCommerce)** 訂單文字/表格，一鍵解析並合併撿貨。
  - 官網改為手動複製後台列表至暫存區 C 欄，不再依賴即時 Webhook。
- **庫存守門員 (InventoryManager)**: 
  - **Oversell Alert**: 產生撿貨單時，若偵測到庫存 < 0，立即回傳 🔥 嚴重警告。
  - **Safety Stock**: 支援紅綠燈水位判斷 (✅ 正常 / ⚠️ 需補貨)。
- **排程自動化 (Automation)**:
  - **每週補貨報告**: 每週一自動檢查低水位商品，發送 LINE 通知。
  - **每日晨報**: 可手動觸發或排程發送當日庫存異常。
- **操作容錯 (Undo)**: 支援「回復上一步」，可自動刪除誤匯入的銷售紀錄並回補庫存。

### 🛠️ 技術架構
- **Web App**: 作為主要操作介面 (index.html)，提供撿貨、入庫、盤點功能。
- **LockService**: 全寫入操作 (入庫/盤點/扣庫存) 皆受並發鎖保護，防止多人操作衝突。
- **LineMessaging**: 負責發送 LINE Notify 通知 (補貨報告、撿貨單)。

## 2. 未來規劃 (Roadmap)
下階段將專注於「數據同步」與「精細化成本管理」。

- **[P1] 多平台庫存回寫 (Multi-platform Sync)**: 
  - 目標：解決蝦皮與官網庫存不同步問題。
  - 實作：開發 **Batch Export** 功能，一鍵生成符合「蝦皮大量更新」格式的 Excel/CSV 檔，手動上傳即可同步庫存。
- **[P2] BOM 自動扣料機制 (Bill of Materials)**: 
  - 目標：精準管理原料庫存。
  - 實作：建立 `[06_配方表]`，設定「成品 vs 原料」對應關係。當成品入庫時，自動扣除對應原料 (如：蜂蠟、亞麻仁油)。
- **[P3] 材積與運費試算 (Carton Calculation)**: 
  - 目標：解決包貨時紙箱選擇困難。
  - 實作：在 SKU 表加入長寬高與重量，生成撿貨單時自動計算該筆訂單適合的紙箱尺寸 (60/90/120 cm)。

## 3. 指令規範 (Instruction for AI)
- 修改程式碼時，**嚴禁** 移除 `_cleanSku` 去汙邏輯。
- 保持 `Code.gs` 的潔淨，不要隨意加入外部 Webhook 接收邏輯。
- 所有庫存寫入操作必須保留 `LockService`。